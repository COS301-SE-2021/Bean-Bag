@using Microsoft.Extensions.Options
@using Microsoft.Identity.Web
@model IEnumerable<Item>
@inject IOptions<MicrosoftIdentityOptions> _azureAdb2COptions


<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

<section class="page-content" xmlns="http://www.w3.org/1999/html">
<section class="search-and-user" >
    <div class="admin-profile" >
        @{
            System.Diagnostics.Debug.Assert(User.Identity != null, "User.Identity != null");
        }
        @if (User.Identity.IsAuthenticated)
        {
            <span class="greeting">

                Hello @User.Identity.Name </span>
      
        }
        <div class="notifications">
            <svg>
                <use xlink:href="#users"></use>
            </svg>
        </div>
    </div>
</section>
<div class="dashboard-wrapper">
<div class="container-fluid  dashboard-content">

<!-- ============================================================== -->
<!-- page-header  -->
<!-- ============================================================== -->
<div class="row">
    <!-- metric -->
    <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 col-12">
        <div data-aos="flip-left"
             data-aos-easing="ease-in-back"
             data-aos-delay="1200"
             data-aos-offset="0">
            <div class="card">
                <div class="card-body">
                    <h5 class="text-muted">Items Available</h5>
                    <div class="metric-value d-inline-block">
                        <h1 class="mb-1 text-primary">32,100 </h1>
                    </div>
                    <div class="metric-label d-inline-block float-right text-success">
                        <i class="fa fa-fw fa-caret-up"></i><span>5.27%</span>
                    </div>
                </div>
                <div id="sparkline-1"></div>
            </div>
        </div>
                    
    </div>
    <!-- /. metric -->
    <!-- metric -->
    <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 col-12">
        <div data-aos="flip-left"
             data-aos-easing="ease-in-back"
             data-aos-delay="1000"
             data-aos-offset="0">
            <div class="card">
                <div class="card-body">
                    <h5 class="text-muted">Items Sold</h5>
                    <div class="metric-value d-inline-block">
                        <h1 class="mb-1 text-primary">4,200 </h1>
                    </div>
                    <div class="metric-label d-inline-block float-right text-danger">
                        <i class="fa fa-fw fa-caret-down"></i><span>1.08%</span>
                    </div>
                </div>
                <div id="sparkline-2"></div>
            </div>
        </div>
                    
    </div>
    <!-- /. metric -->
    <!-- metric -->
    <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 col-12">
                     
        <div data-aos="flip-left"
             data-aos-easing="ease-in-back"
             data-aos-delay="800"
             data-aos-offset="0">
            <div class="card">
                <div class="card-body">
                    <h5 class="text-muted">Revenue</h5>
                    <div class="metric-value d-inline-block">
                        <h1 class="mb-1 text-primary">R5,656</h1>
                    </div>
                    <div class="metric-label d-inline-block float-right text-danger">
                        <i class="fa fa-fw fa-caret-down"></i><span>7.00%</span>
                    </div>
                </div>
                <div id="sparkline-3">
                </div>
            </div>
        </div>
                     
    </div>
    <!-- /. metric -->
    <!-- metric -->
    <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 col-12">
                     
        <div data-aos="flip-left"
             data-aos-easing="ease-in-back"
             data-aos-delay="600"
             data-aos-offset="0">
            <div class="card">
                <div class="card-body">
                    <h5 class="text-muted">Growth</h5>
                    <div class="metric-value d-inline-block">
                        <h1 class="mb-1 text-primary">+28.45% </h1>
                    </div>
                    <div class="metric-label d-inline-block float-right text-success">
                        <i class="fa fa-fw fa-caret-up"></i><span>4.87%</span>
                    </div>
                </div>
                <div id="sparkline-4"></div>
            </div>
        </div>
                    
    </div>
    <!-- /. metric -->
</div>
<br> <br>
<div class="row">
    <!-- ============================================================== -->
    <!-- recent products  -->
    <!-- ============================================================== -->
    <div class="col-xl-7 col-lg-12 col-md-12 col-sm-12 col-12">
        <div data-aos="fade-zoom-in"
             data-aos-easing="fade-zoom-in"
             data-aos-delay="400"
             data-aos-offset="0">

            <div class="card" id="CategoryID" >
                <h5 class="card-header">Recently Added Items</h5>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table">
                            <thead class="bg-light">
                                         
                            <tr>
                                <td colspan="8"> 
                                                 <div  class="float-right" >
                                                     <span class="font-weight-bold"> Inventory : </span>  @Html.DropDownList("InventoryDropDown", ViewBag.InventoryDropDown as SelectList, "Select Inventory")
                        
                                            
                                                 </div>  
                                    <br/>
                                    <hr> 
                                </td>
                                                  
                            </tr>
                                        
                            <tr>
                                <th class="border-0">#</th>
                                <th class="border-0">Image</th>
                                <th class="border-0">Inventory </th>
                                <th class="border-0">Item</th>
                                <th class="border-0">Type</th>
                                <th class="border-0">Quantity</th>
                                <th class="border-0">Price</th>
                                <th class="border-0">Date</th>
                            </tr>
                            </thead>
                            <tbody id="recentItems">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ============================================================== -->
    <!-- end  -->
    <!-- ============================================================== -->
           
             
    <div class="col-xl-4 col-lg-12 col-md-4 col-sm-12 col-12">
        <div data-aos="fade-zoom-in"
             data-aos-easing="ease-in-back"
             data-aos-delay="50"
             data-aos-offset="0">
                                              		
            <div class="card">
                <h5 class="card-header">Total Items</h5>
                <div class="card-body">
                    <div class="float-right">
                        <span class="font-weight-bold"> Inventory : </span> @Html.DropDownList("InventoryDropDownChart", ViewBag.InventoryDropDownChart as SelectList, "Select Inventory")
                    
                          </div>  
                  
                    <canvas id="total-sale" width="220" height="155"></canvas>

                    <br> <br>
                    <div class="chart-widget-list" >
                        
                        <div id="topItems">
                            
                        </div>

                        <p class="mb-0">
                            <span class="fa-xs text-info mr-1 legend-title"></span> <span class="legend-text font-weight-bold"> Total Items </span>
                            <span class="float-right" id="totalItems">0</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ============================================================== -->
    <!-- end total items  -->
    <!-- ============================================================== -->
</div>
               
             
             
             
<div class="page-footer">
    <span>    &copy; 2021 - Agile Bridge </span>
  
</div>
</div>
</div>
</section>

@section Scripts {

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script type="text/javascript">
    
    //Ajax function to get the most recent Items 
      $(document).ready(function ()
      {
         $("#InventoryDropDown").change(function () {
            
           $.getJSON('/Dashboard/GetItems/' +  $("#InventoryDropDown Option:Selected").val(), function (data) { 
                     let items = '';  
                     $.each(data, function (i, item) {
                         if (i<4){
                        let x=i+1;
                         items += '<tr>'+
'                                      '+
'                                <td>'+x+'</td>'+
'                                <td>'+
'                                    <div class="m-r-10"><img src="'+item.imageURL+'" alt="user" class="rounded" width="95"></div>'+
'                                </td>'+
'                                <td>'+$("#InventoryDropDown Option:Selected").text()+'</td>'+
'                                <td>'+item.name+'</td>'+
'                                <td>'+item.type+'</td>'+
'                                <td>'+item.quantity +'</td>'+
'                                <td>'+item.price+'</td>'+
''+
'                                <td>'+item.entryDate+'</td>'+
'                            </tr>';
	
                         }
                     });     
                     $('#recentItems').html(items);  
                 });  
             })                          
        })
        
        
    //Ajax function to get the chart total items 
      $(document).ready(function ()
           {
               
                    let item1='';
                    let item2='';
                    let item3='';
                    var quantity1=0, quantity2=0, quantity3=0;
              
                $("#InventoryDropDownChart").change(function () {
           
                    let inventoryid=$("#InventoryDropDownChart Option:Selected").val();
                    let totalItems=0;
                    let items='';
                    let otherTotal = 0;  
                     let other=0;
                 //Top 3 Items 
                 $.getJSON('/Dashboard/TopItems/' +  inventoryid, function (data) { 
                      
                     $.each(data, function (i, item) { //make if statement for colors
                         
                     if (i===0)
                     {
                         item1=item.type;
                         quantity1= item.qsum;
                     }else if (i===1 )
                     {
                         item2=item.type;
                         quantity2= item.qsum;
                     }else {
                          item3=item.type;
                          quantity3= item.qsum;
                     }
                                 
                         
                         items += '<p>'+
                      '                            <span class="fa-xs text-primary mr-1 legend-title"><i class="fa fa-fw fa-square-full"></i></span><span class="legend-text">'+item.type+'</span>'+
                      '                            <span class="float-right">'+item.qsum+'</span>'+
                      '                        </p>';
                        otherTotal+=item.qsum; 
                        totalItems=item.total;
                      });
                     //Other
                     other=totalItems-otherTotal;
                      
                     if (other!==0){
                       items += '<p>'+
                                      '                            <span class="fa-xs text-primary mr-1 legend-title"><i class="fa fa-fw fa-square-full"></i></span><span class="legend-text"> Other </span>'+
                                      '                            <span class="float-right">'+other+'</span>'+
                                      '                        </p>';}
                     $("#topItems").html(items);  
                   });  
                 
                 //Total Items                    
                  $.getJSON('/Dashboard/TotalItems/' +  inventoryid, function (data) {                  
                    $("#totalItems").text(data); 
                    });  
            
            //Chart
             let ctx = document.getElementById("total-sale").getContext('2d');
                  new Chart(ctx, {
                      type: 'doughnut',
              
                      data: {
                          labels: [item1, item2, item3, "Other"],
                          datasets: [{
                              backgroundColor: [
                                  "#5969ff",
                                  "#ff407b",
                                  "#25d5f2",
                                  "#ffc750"
                              ],
                              data: [quantity1, quantity2, quantity3, other]
                          }]
                      },
                      options: {
                          legend: {
                              display: false
              
                          }
                      }
              
                  });
        
           } )})
           
    </script>
}   
<!-- Optional JavaScript -->
<!-- jquery 3.3.1 js-->
<script src="vendor/jquery/jquery-3.3.1.min.js"></script>
<!-- slimscroll js-->
<script src="vendor/slimscroll/jquery.slimscroll.js"></script>
<!-- chartjs js-->
<script src="vendor/charts/charts-bundle/Chart.bundle.js"></script>
<!-- main js-->
<script src="js/main-js.js"></script>
<!-- dashboard sales js-->

<script>
  AOS.init();
</script>